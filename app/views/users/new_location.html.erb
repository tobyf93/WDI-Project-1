<style type="text/css">
html, body, #mapCanvas { height: 100%; padding: 0;}
</style>

<script type="text/javascript">
  function initialize() {
    var mapOptions = {
      center: { lat: -33.76281, lng: 151.298816},
      zoom: 15
    };

    var map = new google.maps.Map(document.getElementById('mapCanvas'),
        mapOptions);

    // Markers

    <% if @current_user.latitude %>
      var userPos = {lat: <%= @current_user.latitude %>, lng: <%= @current_user.longitude %>}
    <% end %>

    var marker = new google.maps.Marker({
      position: userPos || {lat: -33.76281, lng: 151.298816},
      draggable: true,
      map: map
    });

    circle = new google.maps.Circle({
            map: map,
            clickable: false,
            radius: 100,
            fillColor: '#fff',
            fillOpacity: 0.6,
            strokeColor: '#313131',
            strokeOpacity: 0.4,
            strokeWeight: 0.8
        });

    // attach circle to marker
    circle.bindTo('center', marker, 'position');

    google.maps.event.addListener(marker, 'drag', function() {
      var markerPos = marker.getPosition();
      $('#latitude').val(markerPos.A);
      $('#longitude').val(markerPos.F);
    });
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div id="locationWell" class="well">
  <%= form_tag(user_location_path, :id => 'location', :class => 'form-inline') do %>
    <%= label_tag :latitude %>
    <%= text_field_tag :latitude, nil, :class => 'form-control' %>

    <%= label_tag :longitude %>
    <%= text_field_tag :longitude, nil, :class => 'form-control' %>

    <%= submit_tag 'Set Location', :class => 'btn btn-default' %>
  <% end %>
</div>

<div id="mapCanvas"></div>